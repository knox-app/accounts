<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ignite Mobile 2025</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-body: #F0F2F5;
            --bg-surface: #FFFFFF;
            --primary: #0B57D0;
            --primary-bg: #D3E3FD;
            --text-main: #1F1F1F;
            --text-sec: #444746;
            --border: #E0E2E0;
            --radius-lg: 24px;
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- SIDEBAR (Mobile Drawer) --- */
        .sidebar-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 49;
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .sidebar-backdrop.active { display: block; opacity: 1; }

        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            display: flex; flex-direction: column;
            padding: 12px;
            position: fixed; left: 0; top: 0; bottom: 0;
            z-index: 50;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 12px rgba(0,0,0,0.1);
        }
        .sidebar.open { transform: translateX(0); }

        /* Desktop Sidebar behavior */
        @media (min-width: 769px) {
            .sidebar { position: relative; transform: translateX(0); box-shadow: none; border-right: 1px solid var(--border); }
            .sidebar-backdrop { display: none !important; }
            .menu-toggle { display: none; } /* Hide hamburger on desktop if wanted, or keep for collapse */
        }

        .brand-area { padding: 16px; font-size: 22px; font-weight: 700; color: var(--primary); display: flex; gap: 10px; align-items: center; }
        .create-btn { background: var(--primary-bg); color: #001d35; border: none; padding: 16px; border-radius: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px; margin-bottom: 10px; cursor: pointer; }
        .nav-item { padding: 14px 16px; border-radius: 24px; color: var(--text-sec); font-weight: 500; display: flex; gap: 16px; margin-bottom: 4px; cursor: pointer; }
        .nav-item.active { background: #c2e7ff; color: #001d35; font-weight: 600; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }

        .top-bar {
            height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: var(--bg-surface); border-bottom: 1px solid var(--border);
        }

        .menu-toggle { font-size: 20px; background: none; border: none; padding: 8px; cursor: pointer; }
        
        .search-bar {
            flex: 1; margin: 0 15px; background: #E9EEF6; height: 40px; border-radius: 20px; display: flex; align-items: center; padding: 0 15px;
        }
        .search-bar input { border: none; background: transparent; flex: 1; outline: none; font-size: 16px; font-family: inherit; }

        .profile-trigger { width: 35px; height: 35px; border-radius: 50%; background: var(--primary); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 16px; cursor: pointer; }

        /* Notes Grid */
        .notes-area {
            flex: 1; overflow-y: auto; padding: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); /* Mobile default: 1 column */
            gap: 12px; align-content: start;
        }

        @media (min-width: 600px) {
            .notes-area { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); padding: 25px; }
        }

        .note-card {
            background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 16px;
            height: 140px; display: flex; flex-direction: column; overflow: hidden; position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .note-title { font-weight: 600; font-size: 16px; margin-bottom: 8px; }
        .note-body { font-size: 14px; color: var(--text-sec); line-height: 1.4; }

        /* --- FULL SCREEN EDITOR MODAL --- */
        .editor-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 100;
            display: none; flex-direction: column;
        }
        .editor-overlay.open { display: flex; animation: slideUp 0.25s ease-out; }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .editor-header {
            padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #fff;
        }
        
        /* Mobile Tabs in Editor */
        .mobile-tabs {
            display: flex; border-bottom: 1px solid var(--border); background: #f8f9fa;
        }
        .m-tab {
            flex: 1; text-align: center; padding: 12px; font-size: 14px; font-weight: 500; color: #666; border-bottom: 2px solid transparent; cursor: pointer;
        }
        .m-tab.active { color: var(--primary); border-bottom-color: var(--primary); background: #fff; }

        .editor-body { flex: 1; display: flex; overflow: hidden; position: relative; }

        /* View: Write */
        .view-write { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .inp-title { font-size: 24px; font-weight: 700; border: none; outline: none; margin-bottom: 15px; font-family: inherit; width: 100%; }
        .inp-content { font-size: 16px; line-height: 1.6; border: none; outline: none; flex: 1; resize: none; font-family: inherit; color: var(--text-sec); }

        /* View: Tools */
        .view-tools { flex: 1; padding: 20px; background: #F8F9FA; overflow-y: auto; display: none; }
        .view-tools.active { display: block; }
        
        /* Desktop: Show both side by side */
        @media (min-width: 800px) {
            .mobile-tabs { display: none; } /* Hide tabs on desktop */
            .view-write { border-right: 1px solid var(--border); }
            .view-tools { display: block; width: 300px; border-left: 1px solid var(--border); flex: none; }
        }

        /* Smart Cards */
        .smart-card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .smart-head { font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 10px; display: flex; gap: 8px; align-items: center; }
        .smart-btn { width: 100%; padding: 10px; border-radius: 8px; border: none; background: var(--primary); color: white; font-weight: 600; font-size: 14px; }

        /* Profile Popup */
        .profile-popup {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #fff; border-radius: 24px 24px 0 0; padding: 30px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2); z-index: 200;
            transform: translateY(100%); transition: transform 0.3s;
            text-align: center;
        }
        .profile-popup.active { transform: translateY(0); }
        .profile-backdrop { position: fixed; inset:0; background:rgba(0,0,0,0.5); z-index:199; display:none; }
        .profile-backdrop.active { display:block; }

    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="brand-area">
            <i class="fa-solid fa-bolt"></i> Ignite Mobile
        </div>
        <button class="create-btn" onclick="createNewNote()">
            <i class="fa-solid fa-plus"></i> New Note
        </button>
        <div class="nav-item active"><i class="fa-regular fa-lightbulb"></i> Notes</div>
        <div class="nav-item"><i class="fa-regular fa-bell"></i> Reminders</div>
        <div class="nav-item"><i class="fa-solid fa-archive"></i> Archive</div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="top-bar">
            <button class="menu-toggle" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></button>
            <div class="search-bar">
                <i class="fa-solid fa-search" style="color: #888;"></i>
                <input id="searchInp" type="text" placeholder="Search..." onkeyup="filterNotes()">
            </div>
            <div class="profile-trigger" id="profileBtn" onclick="toggleProfile()">U</div>
        </div>

        <div class="notes-area" id="notesGrid">
            <!-- JS Injected -->
        </div>
    </div>

    <!-- FULL SCREEN EDITOR -->
    <div class="editor-overlay" id="editorOverlay">
        
        <!-- Editor Header -->
        <div class="editor-header">
            <button onclick="closeEditor()" style="background:none; border:none; font-size:24px; color:#444;"><i class="fa-solid fa-arrow-left"></i></button>
            <div id="saveStatus" style="font-size:12px; color:green; font-weight:bold; opacity:0;">Saved</div>
            <button onclick="deleteNote()" style="background:none; border:none; font-size:18px; color:#d93025;"><i class="fa-regular fa-trash-can"></i></button>
        </div>

        <!-- Mobile Tabs (Visible only on mobile via CSS) -->
        <div class="mobile-tabs">
            <div class="m-tab active" onclick="switchTab('write')" id="tabWrite">Write</div>
            <div class="m-tab" onclick="switchTab('tools')" id="tabTools">AI Tools</div>
        </div>

        <!-- Body -->
        <div class="editor-body">
            
            <!-- Writing Area -->
            <div class="view-write" id="viewWrite">
                <input type="text" class="inp-title" id="eTitle" placeholder="Title">
                <textarea class="inp-content" id="eContent" placeholder="Start typing..."></textarea>
            </div>

            <!-- Smart Tools Area -->
            <div class="view-tools" id="viewTools">
                <div class="smart-card">
                    <div class="smart-head"><i class="fa-brands fa-wikipedia-w"></i> Wiki Search</div>
                    <div id="wikiResult" style="font-size:13px; color:#666; margin-bottom:10px; min-height:40px;">Select text & tap search.</div>
                    <button class="smart-btn" onclick="fetchWiki()">Search Highlight</button>
                </div>

                <div class="smart-card">
                    <div class="smart-head"><i class="fa-solid fa-language"></i> Translate</div>
                    <select id="langSelect" style="width:100%; margin-bottom:10px; padding:8px;">
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="ja">Japanese</option>
                    </select>
                    <div id="transResult" style="font-size:13px; margin-bottom:10px;"></div>
                    <button class="smart-btn" style="background:#333;" onclick="fetchTranslate()">Translate</button>
                </div>

                <div class="smart-card">
                    <div class="smart-head"><i class="fa-solid fa-user-plus"></i> Share</div>
                    <button class="smart-btn" style="background:#fff; color:var(--primary); border:1px solid var(--primary);" onclick="shareNote()">Invite by ID</button>
                </div>
            </div>

        </div>
    </div>

    <!-- PROFILE SHEET -->
    <div class="profile-backdrop" id="profileBackdrop" onclick="toggleProfile()"></div>
    <div class="profile-popup" id="profilePopup">
        <div style="width:60px; height:60px; background:var(--primary); border-radius:50%; color:fff; display:flex; justify-content:center; align-items:center; font-size:24px; color:white; margin:0 auto 10px auto;" id="sheetAvatar">U</div>
        <h2 id="sheetName" style="margin:0;">User</h2>
        <p id="sheetEmail" style="color:#666; margin:5px 0 20px 0;">user@ignite.com</p>
        <button onclick="logout()" style="width:100%; padding:15px; border-radius:30px; border:1px solid #ccc; background:transparent; font-size:16px;">Sign Out</button>
    </div>

    <script>
        // --- 1. FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyDL7sPp-FkG59L-mRQ7BrCGgeKMhQC80iw",
            authDomain: "xperts-metadata.firebaseapp.com",
            projectId: "xperts-metadata",
            storageBucket: "xperts-metadata.firebasestorage.app",
            messagingSenderId: "514845910910",
            appId: "1:514845910910:web:5a2402130a97b5d749b52f",
            measurementId: "G-CQ5KWGJSZB"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- 2. LOGIC ---
        let user = null;
        let currentNoteId = null;
        let unsub = null;

        function init() {
            const sess = localStorage.getItem('xperts_multi_session');
            if(!sess) { window.location.href="index.html"; return; }
            user = JSON.parse(sess)[0];
            
            // UI Profile
            document.getElementById('profileBtn').innerText = user.name.charAt(0);
            document.getElementById('sheetAvatar').innerText = user.name.charAt(0);
            document.getElementById('sheetName').innerText = user.name;
            document.getElementById('sheetEmail').innerText = user.igniteId || user.email;

            loadNotes();
        }

        function logout() { localStorage.removeItem('xperts_multi_session'); window.location.href="index.html"; }

        // --- UI TOGGLES ---
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.querySelector('.sidebar-backdrop').classList.toggle('active');
        }

        function toggleProfile() {
            document.getElementById('profilePopup').classList.toggle('active');
            document.getElementById('profileBackdrop').classList.toggle('active');
        }

        function switchTab(tab) {
            // Only relevant on mobile where .mobile-tabs is visible
            document.querySelectorAll('.m-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab === 'write' ? 'tabWrite' : 'tabTools').classList.add('active');
            
            if(tab === 'write') {
                document.getElementById('viewWrite').style.display = 'flex';
                document.getElementById('viewTools').classList.remove('active');
            } else {
                document.getElementById('viewWrite').style.display = 'none';
                document.getElementById('viewTools').classList.add('active');
            }
        }

        // --- NOTES LOGIC ---
        async function createNewNote() {
            const doc = await db.collection('notes').add({
                title:"", content:"", ownerId:user.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            openEditor(doc.id);
            if(window.innerWidth < 768) toggleSidebar(); // Close sidebar on mobile
        }

        function loadNotes() {
            db.collection('notes').where('ownerId', '==', user.uid).onSnapshot(snap => {
                const grid = document.getElementById('notesGrid');
                grid.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    const div = document.createElement('div');
                    div.className = 'note-card';
                    div.onclick = () => openEditor(doc.id);
                    div.innerHTML = `<div class="note-title">${d.title||'Untitled'}</div><div class="note-body">${d.content||'No content'}</div>`;
                    grid.appendChild(div);
                });
            });
        }

        function filterNotes() {
            const term = document.getElementById('searchInp').value.toLowerCase();
            document.querySelectorAll('.note-card').forEach(card => {
                card.style.display = card.innerText.toLowerCase().includes(term) ? 'flex' : 'none';
            });
        }

        // --- EDITOR LOGIC ---
        function openEditor(id) {
            currentNoteId = id;
            document.getElementById('editorOverlay').classList.add('open');
            switchTab('write'); // Reset to write view

            unsub = db.collection('notes').doc(id).onSnapshot(doc => {
                if(!doc.exists) { closeEditor(); return; }
                const d = doc.data();
                if(document.activeElement.id !== 'eTitle') document.getElementById('eTitle').value = d.title;
                if(document.activeElement.id !== 'eContent') document.getElementById('eContent').value = d.content;
            });
        }

        function closeEditor() {
            document.getElementById('editorOverlay').classList.remove('open');
            if(unsub) unsub();
            currentNoteId = null;
        }

        // Auto Save
        let timer;
        const save = () => {
            document.getElementById('saveStatus').style.opacity = 1;
            document.getElementById('saveStatus').innerText = "Saving...";
            clearTimeout(timer);
            timer = setTimeout(() => {
                db.collection('notes').doc(currentNoteId).update({
                    title: document.getElementById('eTitle').value,
                    content: document.getElementById('eContent').value
                }).then(() => {
                    document.getElementById('saveStatus').innerText = "Saved";
                    setTimeout(() => document.getElementById('saveStatus').style.opacity = 0, 2000);
                });
            }, 500);
        }
        document.getElementById('eTitle').addEventListener('input', save);
        document.getElementById('eContent').addEventListener('input', save);

        async function deleteNote() {
            if(confirm('Delete?')) { await db.collection('notes').doc(currentNoteId).delete(); closeEditor(); }
        }

        // --- SMART TOOLS ---
        function getSel() { return window.getSelection().toString().trim(); }

        async function fetchWiki() {
            const txt = getSel();
            const res = document.getElementById('wikiResult');
            if(!txt) { res.innerText = "Select text first."; return; }
            res.innerText = "Searching...";
            try {
                const req = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(txt)}`);
                const data = await req.json();
                res.innerHTML = `<b>${data.title}</b><br>${data.extract}`;
            } catch(e) { res.innerText = "No results."; }
        }

        async function fetchTranslate() {
            const txt = getSel();
            const res = document.getElementById('transResult');
            const lang = document.getElementById('langSelect').value;
            if(!txt) { res.innerText = "Select text first."; return; }
            res.innerText = "Translating...";
            try {
                const req = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(txt)}&langpair=en|${lang}`);
                const data = await req.json();
                res.innerText = data.responseData.translatedText;
            } catch(e) { res.innerText = "Error."; }
        }

        async function shareNote() {
            const email = prompt("Ignite ID (@ignite.com):");
            if(email && email.endsWith('@ignite.com')) {
                await db.collection('notes').doc(currentNoteId).update({
                    sharedWith: firebase.firestore.FieldValue.arrayUnion(email)
                });
                alert('Shared');
            }
        }

        init();
    </script>
</body>
</html>